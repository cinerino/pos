(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{cfg2:function(e,t,n){"use strict";n.r(t),n.d(t,"OrderModule",(function(){return pe}));var r=n("2kYt"),c=n("DSWM"),i=n("sEIs"),o=n("unpb"),a=n("RRjC"),d=n("icHh"),s=n("sN6X"),l=n("wgY5"),h=n("x8Mb"),u=n("PIN6"),m=n("cHUu"),p=n("mOXJ"),g=n("EM62"),f=n("s2Ay"),v=n("QN9p"),b=n("nIj0"),y=n("ddJ1"),O=n("OSFB"),P=function(e,t,n,r){return new(n||(n=Promise))((function(c,i){function o(e){try{d(r.next(e))}catch(t){i(t)}}function a(e){try{d(r.throw(e))}catch(t){i(t)}}function d(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}d((r=r.apply(e,t||[])).next())}))};const w=["orderDateFrom"],S=["orderDateThrough"],D=["eventStartDateFrom"],M=["eventStartDateThrough"];function C(e,t){if(1&e&&(g.Pc(0,"option",19),g.zd(1),g.Oc()),2&e){const e=t.$implicit;g.ed("value",e.id),g.wc(1),g.Bd("",e.name," ")}}function x(e,t){if(1&e&&(g.Pc(0,"option",19),g.zd(1),g.Zc(2,"changeLanguage"),g.Oc()),2&e){const e=t.$implicit;g.ed("value",e.codeValue),g.wc(1),g.Bd(" ",g.ad(2,2,e.name)," ")}}const k=function(){return{dateInputFormat:"YYYY/MM/DD",adaptivePosition:!0,showWeekNumbers:!1}};class T{constructor(e,t){this.store=e,this.localeService=t,this.moment=l,this.orderStatus=d.factory.orderStatus,this.paymentMethodType=d.factory.paymentMethodType,this.environment=Object(u.a)(),this.connectionType=h.b.Util.Printer.ConnectionType,this.changeConditions=new g.w}ngOnInit(){this.isLoading=this.store.pipe(Object(s.m)(p.c)),this.user=this.store.pipe(Object(s.m)(p.i)),this.clear()}submit(){return P(this,void 0,void 0,(function*(){Object.keys(this.conditions).forEach(e=>{"confirmationNumber"!==e&&"orderNumber"!==e?"familyName"!==e&&"givenName"!==e&&"email"!==e&&"telephone"!==e||(this.conditions.customer[e]=document.getElementById(e).value):this.conditions[e]=document.getElementById(e).value}),this.changeConditions.emit(this.conditions)}))}clear(){if(this.conditions={confirmationNumber:"",orderNumber:"",customer:{id:"",familyName:"",givenName:"",email:"",telephone:""},orderStatus:"",paymentMethodType:"",posId:"",page:1},this.orderDateValidation){const e=l().toDate(),t=l(l(e).format("YYYYMMDD"));this.conditions.orderDateFrom=l(t).add(-4,"month").toDate(),this.conditions.orderDateThrough=l(t).toDate()}Object.keys(this.conditions).forEach(e=>{null!==document.getElementById(e)&&(document.getElementById(e).value="")})}setDatePicker(){this.user.subscribe(e=>{this.localeService.use(e.language)}).unsubscribe()}onShowPicker(e){h.a.Util.iOSDatepickerTapBugFix(e,[this.orderDateFrom,this.orderDateThrough,this.eventStartDateFrom,this.eventStartDateThrough])}}T.\u0275fac=function(e){return new(e||T)(g.Jc(s.b),g.Jc(v.d))},T.\u0275cmp=g.Dc({type:T,selectors:[["app-order-condition"]],viewQuery:function(e,t){var n;(1&e&&(g.vd(w,!0),g.vd(S,!0),g.vd(D,!0),g.vd(M,!0)),2&e)&&(g.nd(n=g.Xc())&&(t.orderDateFrom=n.first),g.nd(n=g.Xc())&&(t.orderDateThrough=n.first),g.nd(n=g.Xc())&&(t.eventStartDateFrom=n.first),g.nd(n=g.Xc())&&(t.eventStartDateThrough=n.first))},inputs:{name:"name",orderDateValidation:"orderDateValidation",paymentTypes:"paymentTypes"},outputs:{changeConditions:"changeConditions"},decls:125,vars:117,consts:[[3,"submit"],[1,"form-row"],[1,"form-group","col-12","col-sm-6","col-md-4","col-lg-3"],["for","orderDateFrom",1,"mb-2","text-small"],[1,"position-relative"],["type","text","name","orderDateFrom","id","orderDateFrom","placeholder","YYYY/MM/DD","bsDatepicker","","readonly","",1,"form-control",3,"ngModel","bsConfig","ngModelChange","onShown","click"],["orderDateFrom","bsDatepicker"],[1,"datepicker-append","d-flex","align-items-center","px-2",3,"click"],[1,"bi","bi-x"],["for","orderDateThrough",1,"mb-2","text-small"],["type","text","name","orderDateThrough","id","orderDateThrough","placeholder","YYYY/MM/DD","bsDatepicker","","readonly","",1,"form-control",3,"ngModel","bsConfig","ngModelChange","onShown","click"],["orderDateThrough","bsDatepicker"],["for","confirmationNumber",1,"mb-2","text-small"],["type","text","name","confirmationNumber","id","confirmationNumber",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","orderNumber",1,"mb-2","text-small"],["type","text","name","orderNumber","id","orderNumber",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","orderStatus",1,"mb-2","text-small"],["name","orderStatus","id","orderStatus",1,"form-control",3,"ngModel","ngModelChange"],["value",""],[3,"value"],["for","familyName",1,"mb-2","text-small"],["type","text","name","familyName","id","familyName",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","givenName",1,"mb-2","text-small"],["type","text","name","givenName","id","givenName",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","email",1,"mb-2","text-small"],["type","email","name","email","id","email",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","telephone",1,"mb-2","text-small"],["type","telephone","name","telephone","id","telephone",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","customerId",1,"mb-2","text-small"],["type","text","name","customerId","id","customerId",1,"form-control",3,"ngModel","placeholder","ngModelChange"],["for","eventStartDateFrom",1,"mb-2","text-small"],["type","text","name","eventStartDateFrom","id","eventStartDateFrom","placeholder","YYYY/MM/DD","bsDatepicker","","readonly","",1,"form-control",3,"ngModel","bsConfig","ngModelChange","onShown","click"],["eventStartDateFrom","bsDatepicker"],["for","eventStartDateThrough",1,"mb-2","text-small"],["type","text","name","eventStartDateThrough","id","eventStartDateThrough","placeholder","YYYY/MM/DD","bsDatepicker","","readonly","",1,"form-control",3,"ngModel","bsConfig","ngModelChange","onShown","click"],["eventStartDateThrough","bsDatepicker"],["for","posId",1,"mb-2","text-small"],["name","posId","id","posId",1,"form-control",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],["for","paymentMethodType",1,"mb-2","text-small"],["name","paymentMethodType","id","paymentMethodType",1,"form-control",3,"ngModel","ngModelChange"],[1,"buttons","mx-auto","text-center"],["type","submit",1,"btn","btn-primary","btn-block","py-3","mb-3",3,"disabled"],["type","button",1,"btn","btn-outline-primary","btn-block","py-3",3,"click"]],template:function(e,t){if(1&e&&(g.Pc(0,"form",0),g.Wc("submit",(function(){return t.submit()})),g.Pc(1,"div",1),g.Pc(2,"div",2),g.Pc(3,"label",3),g.zd(4),g.Zc(5,"translate"),g.Oc(),g.Pc(6,"div",4),g.Pc(7,"input",5,6),g.Wc("ngModelChange",(function(e){return t.conditions.orderDateFrom=e}))("onShown",(function(e){return t.onShowPicker(e)}))("click",(function(){return t.setDatePicker()})),g.Oc(),g.Pc(9,"div",7),g.Wc("click",(function(){return t.conditions.orderDateFrom=void 0})),g.Kc(10,"i",8),g.Oc(),g.Oc(),g.Oc(),g.Pc(11,"div",2),g.Pc(12,"label",9),g.zd(13),g.Zc(14,"translate"),g.Oc(),g.Pc(15,"div",4),g.Pc(16,"input",10,11),g.Wc("ngModelChange",(function(e){return t.conditions.orderDateThrough=e}))("onShown",(function(e){return t.onShowPicker(e)}))("click",(function(){return t.setDatePicker()})),g.Oc(),g.Pc(18,"div",7),g.Wc("click",(function(){return t.conditions.orderDateThrough=void 0})),g.Kc(19,"i",8),g.Oc(),g.Oc(),g.Oc(),g.Pc(20,"div",2),g.Pc(21,"label",12),g.zd(22),g.Zc(23,"translate"),g.Oc(),g.Pc(24,"input",13),g.Wc("ngModelChange",(function(e){return t.conditions.confirmationNumber=e})),g.Zc(25,"translate"),g.Oc(),g.Oc(),g.Pc(26,"div",2),g.Pc(27,"label",14),g.zd(28),g.Zc(29,"translate"),g.Oc(),g.Pc(30,"input",15),g.Wc("ngModelChange",(function(e){return t.conditions.orderNumber=e})),g.Zc(31,"translate"),g.Oc(),g.Oc(),g.Pc(32,"div",2),g.Pc(33,"label",16),g.zd(34),g.Zc(35,"translate"),g.Oc(),g.Pc(36,"select",17),g.Wc("ngModelChange",(function(e){return t.conditions.orderStatus=e})),g.Pc(37,"option",18),g.zd(38),g.Zc(39,"translate"),g.Oc(),g.Pc(40,"option",19),g.zd(41),g.Zc(42,"translate"),g.Oc(),g.Pc(43,"option",19),g.zd(44),g.Zc(45,"translate"),g.Oc(),g.Pc(46,"option",19),g.zd(47),g.Zc(48,"translate"),g.Oc(),g.Oc(),g.Oc(),g.Oc(),g.Pc(49,"div",1),g.Pc(50,"div",2),g.Pc(51,"label",20),g.zd(52),g.Zc(53,"translate"),g.Oc(),g.Pc(54,"input",21),g.Wc("ngModelChange",(function(e){return t.conditions.customer.familyName=e})),g.Zc(55,"translate"),g.Oc(),g.Oc(),g.Pc(56,"div",2),g.Pc(57,"label",22),g.zd(58),g.Zc(59,"translate"),g.Oc(),g.Pc(60,"input",23),g.Wc("ngModelChange",(function(e){return t.conditions.customer.givenName=e})),g.Zc(61,"translate"),g.Oc(),g.Oc(),g.Pc(62,"div",2),g.Pc(63,"label",24),g.zd(64),g.Zc(65,"translate"),g.Oc(),g.Pc(66,"input",25),g.Wc("ngModelChange",(function(e){return t.conditions.customer.email=e})),g.Zc(67,"translate"),g.Oc(),g.Oc(),g.Pc(68,"div",2),g.Pc(69,"label",26),g.zd(70),g.Zc(71,"translate"),g.Oc(),g.Pc(72,"input",27),g.Wc("ngModelChange",(function(e){return t.conditions.customer.telephone=e})),g.Zc(73,"translate"),g.Oc(),g.Oc(),g.Pc(74,"div",2),g.Pc(75,"label",28),g.zd(76),g.Zc(77,"translate"),g.Oc(),g.Pc(78,"input",29),g.Wc("ngModelChange",(function(e){return t.conditions.customer.id=e})),g.Zc(79,"translate"),g.Oc(),g.Oc(),g.Oc(),g.Pc(80,"div",1),g.Pc(81,"div",2),g.Pc(82,"label",30),g.zd(83),g.Zc(84,"translate"),g.Oc(),g.Pc(85,"div",4),g.Pc(86,"input",31,32),g.Wc("ngModelChange",(function(e){return t.conditions.eventStartDateFrom=e}))("onShown",(function(e){return t.onShowPicker(e)}))("click",(function(){return t.setDatePicker()})),g.Oc(),g.Pc(88,"div",7),g.Wc("click",(function(){return t.conditions.eventStartDateFrom=void 0})),g.Kc(89,"i",8),g.Oc(),g.Oc(),g.Oc(),g.Pc(90,"div",2),g.Pc(91,"label",33),g.zd(92),g.Zc(93,"translate"),g.Oc(),g.Pc(94,"div",4),g.Pc(95,"input",34,35),g.Wc("ngModelChange",(function(e){return t.conditions.eventStartDateThrough=e}))("onShown",(function(e){return t.onShowPicker(e)}))("click",(function(){return t.setDatePicker()})),g.Oc(),g.Pc(97,"div",7),g.Wc("click",(function(){return t.conditions.eventStartDateThrough=void 0})),g.Kc(98,"i",8),g.Oc(),g.Oc(),g.Oc(),g.Pc(99,"div",2),g.Pc(100,"label",36),g.zd(101),g.Zc(102,"translate"),g.Oc(),g.Pc(103,"select",37),g.Wc("ngModelChange",(function(e){return t.conditions.posId=e})),g.Pc(104,"option",18),g.zd(105),g.Zc(106,"translate"),g.Oc(),g.xd(107,C,2,2,"option",38),g.Zc(108,"async"),g.Oc(),g.Oc(),g.Pc(109,"div",2),g.Pc(110,"label",39),g.zd(111),g.Zc(112,"translate"),g.Oc(),g.Pc(113,"select",40),g.Wc("ngModelChange",(function(e){return t.conditions.paymentMethodType=e})),g.Pc(114,"option",18),g.zd(115),g.Zc(116,"translate"),g.Oc(),g.xd(117,x,3,4,"option",38),g.Oc(),g.Oc(),g.Oc(),g.Pc(118,"div",41),g.Pc(119,"button",42),g.Zc(120,"async"),g.zd(121),g.Oc(),g.Pc(122,"button",43),g.Wc("click",(function(){return t.clear()})),g.zd(123),g.Zc(124,"translate"),g.Oc(),g.Oc(),g.Oc()),2&e){var n;const e=null==(n=g.ad(108,103,t.user))?null:n.theater.hasPOS;g.wc(4),g.Ad(g.ad(5,53,"order.search.conditions.orderDateFrom")),g.wc(3),g.ed("ngModel",t.conditions.orderDateFrom)("bsConfig",g.gd(113,k)),g.wc(6),g.Ad(g.ad(14,55,"order.search.conditions.orderDateThrough")),g.wc(3),g.ed("ngModel",t.conditions.orderDateThrough)("bsConfig",g.gd(114,k)),g.wc(6),g.Ad(g.ad(23,57,"common.confirmationNumber")),g.wc(2),g.fd("placeholder",g.ad(25,59,"common.confirmationNumber")),g.ed("ngModel",t.conditions.confirmationNumber),g.wc(4),g.Ad(g.ad(29,61,"common.orderNumber")),g.wc(2),g.fd("placeholder",g.ad(31,63,"common.orderNumber")),g.ed("ngModel",t.conditions.orderNumber),g.wc(4),g.Ad(g.ad(35,65,"common.orderStatus")),g.wc(2),g.ed("ngModel",t.conditions.orderStatus),g.wc(2),g.Ad(g.ad(39,67,"common.all")),g.wc(2),g.ed("value",t.orderStatus.OrderDelivered),g.wc(1),g.Bd(" ",g.ad(42,69,"order.search.orderStatus.orderDelivered"),""),g.wc(2),g.ed("value",t.orderStatus.OrderProcessing),g.wc(1),g.Bd(" ",g.ad(45,71,"order.search.orderStatus.orderProcessing"),""),g.wc(2),g.ed("value",t.orderStatus.OrderReturned),g.wc(1),g.Bd(" ",g.ad(48,73,"order.search.orderStatus.orderReturned"),""),g.wc(5),g.Ad(g.ad(53,75,"common.familyName")),g.wc(2),g.fd("placeholder",g.ad(55,77,"common.familyName")),g.ed("ngModel",t.conditions.customer.familyName),g.wc(4),g.Ad(g.ad(59,79,"common.givenName")),g.wc(2),g.fd("placeholder",g.ad(61,81,"common.givenName")),g.ed("ngModel",t.conditions.customer.givenName),g.wc(4),g.Ad(g.ad(65,83,"common.email")),g.wc(2),g.fd("placeholder",g.ad(67,85,"common.email")),g.ed("ngModel",t.conditions.customer.email),g.wc(4),g.Ad(g.ad(71,87,"order.search.conditions.telephone")),g.wc(2),g.fd("placeholder",g.ad(73,89,"order.search.conditions.telephone")),g.ed("ngModel",t.conditions.customer.telephone),g.wc(4),g.Ad(g.ad(77,91,"order.search.conditions.customer.id")),g.wc(2),g.fd("placeholder",g.ad(79,93,"order.search.conditions.customer.id")),g.ed("ngModel",t.conditions.customer.id),g.wc(5),g.Bd(" ",g.ad(84,95,"order.search.conditions.eventStartDateFrom")," "),g.wc(3),g.ed("ngModel",t.conditions.eventStartDateFrom)("bsConfig",g.gd(115,k)),g.wc(6),g.Ad(g.ad(93,97,"order.search.conditions.eventStartDateThrough")),g.wc(3),g.ed("ngModel",t.conditions.eventStartDateThrough)("bsConfig",g.gd(116,k)),g.wc(6),g.Ad(g.ad(102,99,"order.search.conditions.pos")),g.wc(2),g.ed("ngModel",t.conditions.posId),g.wc(2),g.Ad(g.ad(106,101,"common.all")),g.wc(2),g.ed("ngForOf",e),g.wc(4),g.Ad(g.ad(112,105,"common.paymentMethod")),g.wc(2),g.ed("ngModel",t.conditions.paymentMethodType),g.wc(2),g.Ad(g.ad(116,107,"common.all")),g.wc(2),g.ed("ngForOf",t.paymentTypes),g.wc(2),g.ed("disabled",g.ad(120,109,t.isLoading)),g.wc(2),g.Ad(t.name),g.wc(2),g.Ad(g.ad(124,111,"order.search.clear"))}},directives:[b.u,b.l,b.m,v.b,b.a,v.a,b.k,b.n,y.b,b.r,b.o,b.t,r.k],pipes:[f.c,r.b,O.a],styles:[""]});var Y=function(e,t,n,r){return new(n||(n=Promise))((function(c,i){function o(e){try{d(r.next(e))}catch(t){i(t)}}function a(e){try{d(r.throw(e))}catch(t){i(t)}}function d(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}d((r=r.apply(e,t||[])).next())}))};function N(e,t){if(1&e){const e=g.Qc();g.Pc(0,"div",6),g.Pc(1,"app-order-condition",7),g.Wc("changeConditions",(function(t){g.rd(e);return g.Yc().changeConditions(t)})),g.Zc(2,"translate"),g.Oc(),g.Oc()}if(2&e){const e=g.Yc();g.wc(1),g.ed("name",g.ad(2,3,"order.download.download"))("paymentTypes",e.paymentTypes)("orderDateValidation",!0)}}class A{constructor(e,t,n,r,c,i,o){this.store=e,this.utilService=t,this.actionService=n,this.downloadService=r,this.translate=c,this.masterService=i,this.router=o,this.moment=l,this.orderStatus=d.factory.orderStatus,this.paymentMethodType=d.factory.paymentMethodType,this.environment=Object(u.a)(),this.order2EventOrders=h.a.Purchase.order2EventOrders}ngOnInit(){return Y(this,void 0,void 0,(function*(){this.isLoading=this.store.pipe(Object(s.m)(p.c)),this.error=this.store.pipe(Object(s.m)(p.b)),this.order=this.store.pipe(Object(s.m)(p.e)),this.user=this.store.pipe(Object(s.m)(p.i)),this.paymentTypes=[],this.actionService.order.delete();try{this.paymentTypes=yield this.masterService.searchCategoryCode({categorySetIdentifier:d.factory.chevre.categoryCode.CategorySetIdentifier.PaymentMethodType})}catch(e){return void this.router.navigate(["/error"])}}))}download(){return Y(this,void 0,void 0,(function*(){try{const e=h.a.Order.input2OrderSearchCondition({input:this.conditions,theater:(yield this.actionService.user.getData()).theater});yield this.downloadService.order(e)}catch(e){console.error(e),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.download.alert.download"),error:"{}"===JSON.stringify(e)?e:JSON.stringify(e)})}}))}changeConditions(e){return Y(this,void 0,void 0,(function*(){this.conditions=e,yield this.download()}))}}A.\u0275fac=function(e){return new(e||A)(g.Jc(s.b),g.Jc(m.f),g.Jc(m.a),g.Jc(m.c),g.Jc(f.d),g.Jc(m.d),g.Jc(i.b))},A.\u0275cmp=g.Dc({type:A,selectors:[["app-order-download"]],decls:11,vars:10,consts:[[1,"contents-width","mx-auto","px-3","py-5"],[1,"text-large","mb-4","text-center","font-weight-bold"],[1,"mb-4","text-md-center",3,"innerHTML"],["class","conditions p-3 bg-white mb-4",4,"ngIf"],[1,"buttons","mx-auto","text-center"],["type","button","routerLink","/order",1,"btn","btn-outline-primary","btn-block","py-3"],[1,"conditions","p-3","bg-white","mb-4"],[3,"name","paymentTypes","orderDateValidation","changeConditions"]],template:function(e,t){1&e&&(g.Pc(0,"div",0),g.Pc(1,"h2",1),g.zd(2),g.Zc(3,"translate"),g.Oc(),g.Kc(4,"p",2),g.Zc(5,"translate"),g.xd(6,N,3,5,"div",3),g.Pc(7,"div",4),g.Pc(8,"button",5),g.zd(9),g.Zc(10,"translate"),g.Oc(),g.Oc(),g.Oc()),2&e&&(g.wc(2),g.Ad(g.ad(3,4,"order.download.title")),g.wc(2),g.ed("innerHTML",g.ad(5,6,"order.download.read"),g.sd),g.wc(2),g.ed("ngIf",t.paymentTypes.length>0),g.wc(3),g.Ad(g.ad(10,8,"order.download.prev")))},directives:[r.l,i.c,T],pipes:[f.c],styles:[".scroll-horizontal[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{min-width:950px}"]});class E{constructor(){}ngOnInit(){}}E.\u0275fac=function(e){return new(e||E)},E.\u0275cmp=g.Dc({type:E,selectors:[["app-order-index"]],decls:22,vars:12,consts:[[1,"contents-width","mx-auto","px-3","py-5"],[1,"text-large","mb-4","text-center","font-weight-bold"],[1,"mb-4","text-md-center",3,"innerHTML"],[1,"container","px-0"],[1,"row"],[1,"col-md-4","col-12"],["type","button","routerLink","/order/search",1,"btn","btn-primary","btn-block","py-3","mb-3"],[1,"d-block","mb-2"],[1,"d-block","text-x-large"],[1,"bi","bi-search"],["type","button","routerLink","/order/download",1,"btn","btn-primary","btn-block","py-3","mb-3"],[1,"bi","bi-file-earmark-arrow-down"]],template:function(e,t){1&e&&(g.Pc(0,"div",0),g.Pc(1,"h2",1),g.zd(2),g.Zc(3,"translate"),g.Oc(),g.Kc(4,"p",2),g.Zc(5,"translate"),g.Pc(6,"div",3),g.Pc(7,"div",4),g.Pc(8,"div",5),g.Pc(9,"button",6),g.Pc(10,"span",7),g.zd(11),g.Zc(12,"translate"),g.Oc(),g.Pc(13,"span",8),g.Kc(14,"i",9),g.Oc(),g.Oc(),g.Oc(),g.Pc(15,"div",5),g.Pc(16,"button",10),g.Pc(17,"span",7),g.zd(18),g.Zc(19,"translate"),g.Oc(),g.Pc(20,"span",8),g.Kc(21,"i",11),g.Oc(),g.Oc(),g.Oc(),g.Oc(),g.Oc(),g.Oc()),2&e&&(g.wc(2),g.Ad(g.ad(3,4,"order.index.title")),g.wc(2),g.ed("innerHTML",g.ad(5,6,"order.index.read"),g.sd),g.wc(7),g.Ad(g.ad(12,8,"order.index.list.search.title")),g.wc(7),g.Ad(g.ad(19,10,"order.index.list.download.title")))},directives:[i.c],pipes:[f.c],styles:[""]});var I=n("MMGj"),Z=n("yBiJ"),z=n("dLRM"),W=n("/Ez/"),F=n("iinx"),J=n("NSn/");function R(e,t){if(1&e){const e=g.Qc();g.Pc(0,"i",17),g.Wc("click",(function(){g.rd(e);const t=g.Yc(2).$implicit;return g.Yc().select.emit(t)})),g.Oc()}}function L(e,t){if(1&e){const e=g.Qc();g.Pc(0,"i",18),g.Wc("click",(function(){g.rd(e);const t=g.Yc(2).$implicit;return g.Yc().select.emit(t)})),g.Oc()}}function j(e,t){if(1&e&&(g.Pc(0,"div"),g.xd(1,R,1,0,"i",15),g.xd(2,L,1,0,"i",16),g.Oc()),2&e){const e=g.Yc().$implicit,t=g.Yc();g.wc(1),g.ed("ngIf",!t.isSelected(e)),g.wc(1),g.ed("ngIf",t.isSelected(e))}}function H(e,t){1&e&&(g.Pc(0,"div"),g.Kc(1,"i",19),g.Oc())}function B(e,t){if(1&e&&(g.Pc(0,"span",24),g.zd(1),g.Zc(2,"changeLanguage"),g.Oc()),2&e){const e=g.Yc().$implicit;g.wc(1),g.Ad(g.ad(2,1,e.event.location.address))}}function K(e,t){if(1&e&&(g.Pc(0,"div"),g.Pc(1,"p",20),g.zd(2),g.Zc(3,"changeLanguage"),g.Oc(),g.Pc(4,"p"),g.Pc(5,"span",21),g.zd(6),g.Zc(7,"changeLanguage"),g.Oc(),g.Pc(8,"span",22),g.zd(9,"\xa0/\xa0"),g.xd(10,B,3,3,"span",23),g.Zc(11,"changeLanguage"),g.zd(12),g.Zc(13,"changeLanguage"),g.Oc(),g.Oc(),g.Pc(14,"p"),g.zd(15),g.Zc(16,"formatDate"),g.Oc(),g.Oc()),2&e){const e=t.$implicit;g.wc(2),g.Bd(" ",g.ad(3,5,e.event.name)," "),g.wc(4),g.Ad(g.ad(7,7,e.event.superEvent.location.name)),g.wc(4),g.ed("ngIf",g.ad(11,9,e.event.location.address)),g.wc(2),g.Ad(g.ad(13,11,e.event.location.name)),g.wc(3),g.Bd("",g.bd(16,13,e.event.startDate,"YYYY/MM/DD (ddd) HH:mm")," -")}}function $(e,t){if(1&e){const e=g.Qc();g.Pc(0,"button",25),g.Wc("click",(function(){g.rd(e);const t=g.Yc().$implicit;return g.Yc().print.emit([t])})),g.Zc(1,"async"),g.Kc(2,"i",26),g.Oc()}if(2&e){const e=g.Yc().$implicit,t=g.Yc();var n;const r=(null==(n=g.ad(1,1,t.user))?null:n.printer.connectionType)===t.connectionType.None||e.orderStatus!==t.orderStatus.OrderDelivered;g.ed("disabled",r)}}function _(e,t){if(1&e){const e=g.Qc();g.Pc(0,"button",25),g.Wc("click",(function(){g.rd(e);const t=g.Yc().$implicit;return g.Yc().receipt.emit([t])})),g.Zc(1,"async"),g.Kc(2,"i",27),g.Oc()}if(2&e){const e=g.Yc().$implicit,t=g.Yc();var n;const r=(null==(n=g.ad(1,1,t.user))?null:n.printer.connectionType)===t.connectionType.None||e.orderStatus!==t.orderStatus.OrderDelivered;g.ed("disabled",r)}}function Q(e,t){if(1&e){const e=g.Qc();g.Pc(0,"button",28),g.Wc("click",(function(){g.rd(e);const t=g.Yc().$implicit;return g.Yc().return.emit([t])})),g.Kc(1,"i",29),g.Oc()}if(2&e){const e=g.Yc().$implicit,t=g.Yc();g.ed("disabled",e.orderStatus!==t.orderStatus.OrderDelivered)}}const U=function(e){return{order:e}};function G(e,t){if(1&e){const e=g.Qc();g.Pc(0,"tr"),g.Pc(1,"td",6),g.xd(2,j,3,2,"div",7),g.xd(3,H,2,0,"div",7),g.Oc(),g.Pc(4,"td",8),g.Pc(5,"p"),g.zd(6),g.Zc(7,"formatDate"),g.Oc(),g.Oc(),g.Pc(8,"td",8),g.zd(9),g.Oc(),g.Pc(10,"td",8),g.xd(11,K,17,16,"div",9),g.Oc(),g.Pc(12,"td",8),g.Pc(13,"p"),g.zd(14),g.Oc(),g.Oc(),g.Pc(15,"td",10),g.Pc(16,"button",11),g.Wc("click",(function(){g.rd(e);const n=t.$implicit;return g.Yc().detail.emit(n)})),g.Kc(17,"i",12),g.Oc(),g.xd(18,$,3,3,"button",13),g.xd(19,_,3,3,"button",13),g.xd(20,Q,2,1,"button",14),g.Oc(),g.Oc()}if(2&e){const e=t.$implicit,n=t.index,r=g.Yc();g.Bc("bg-light-gray",n%2==0),g.wc(2),g.ed("ngIf",e.orderStatus===r.orderStatus.OrderDelivered),g.wc(1),g.ed("ngIf",e.orderStatus!==r.orderStatus.OrderDelivered),g.wc(3),g.Ad(g.bd(7,12,e.orderDate,"YYYY/MM/DD (ddd) HH:mm")),g.wc(3),g.Ad(e.confirmationNumber),g.wc(2),g.ed("ngForOf",r.order2EventOrders(g.hd(15,U,e))),g.wc(3),g.Cd("",e.customer.familyName," ",e.customer.givenName,""),g.wc(4),g.ed("ngIf",r.environment.ORDER_PRINT),g.wc(1),g.ed("ngIf",r.environment.PRINT_RECEIPT),g.wc(1),g.ed("ngIf",r.environment.ORDER_CANCEL)}}class V{constructor(e){this.store=e,this.moment=l,this.orderStatus=d.factory.orderStatus,this.connectionType=h.b.Util.Printer.ConnectionType,this.environment=Object(u.a)(),this.order2EventOrders=h.a.Purchase.order2EventOrders,this.select=new g.w,this.detail=new g.w,this.print=new g.w,this.receipt=new g.w,this.return=new g.w}ngOnInit(){this.isLoading=this.store.pipe(Object(s.m)(p.c)),this.user=this.store.pipe(Object(s.m)(p.i))}isSelected(e){return void 0!==this.selectedOrders.find(t=>t.orderNumber===e.orderNumber)}}V.\u0275fac=function(e){return new(e||V)(g.Jc(s.b))},V.\u0275cmp=g.Dc({type:V,selectors:[["app-order-table"]],inputs:{orders:"orders",selectedOrders:"selectedOrders"},outputs:{select:"select",detail:"detail",print:"print",receipt:"receipt",return:"return"},decls:19,vars:13,consts:[[1,"table","table-bordered","bg-white","text-small","mb-0","border","border-gray"],["scope","col"],["scope","col",2,"min-width","160px"],["scope","col",2,"min-width","80px"],["scope","col",2,"min-width","240px"],[3,"bg-light-gray",4,"ngFor","ngForOf"],[1,"align-middle","text-large","text-center"],[4,"ngIf"],[1,"align-middle"],[4,"ngFor","ngForOf"],[1,"align-middle","text-center"],[1,"btn","btn-primary","mr-2",3,"click"],[1,"bi","bi-zoom-in"],["class","btn btn-primary mr-2",3,"disabled","click",4,"ngIf"],["class","btn btn-primary",3,"disabled","click",4,"ngIf"],["class","bi bi-square pointer",3,"click",4,"ngIf"],["class","bi bi-check-square pointer",3,"click",4,"ngIf"],[1,"bi","bi-square","pointer",3,"click"],[1,"bi","bi-check-square","pointer",3,"click"],[1,"bi","bi-square","opacity-0"],[2,"width","280px"],[1,"theater-name"],[1,"screen-name"],["class","mr-2",4,"ngIf"],[1,"mr-2"],[1,"btn","btn-primary","mr-2",3,"disabled","click"],[1,"bi","bi-printer"],[1,"bi","bi-receipt"],[1,"btn","btn-primary",3,"disabled","click"],[1,"bi","bi-reply"]],template:function(e,t){1&e&&(g.Pc(0,"table",0),g.Pc(1,"thead"),g.Pc(2,"tr"),g.Kc(3,"th",1),g.Pc(4,"th",2),g.zd(5),g.Zc(6,"translate"),g.Oc(),g.Pc(7,"th",3),g.zd(8),g.Zc(9,"translate"),g.Oc(),g.Pc(10,"th",1),g.zd(11),g.Zc(12,"translate"),g.Oc(),g.Pc(13,"th",1),g.zd(14),g.Zc(15,"translate"),g.Oc(),g.Kc(16,"th",4),g.Oc(),g.Oc(),g.Pc(17,"tbody"),g.xd(18,G,21,17,"tr",5),g.Oc(),g.Oc()),2&e&&(g.wc(5),g.Ad(g.ad(6,5,"common.orderDate")),g.wc(3),g.Ad(g.ad(9,7,"common.confirmationNumber")),g.wc(3),g.Ad(g.ad(12,9,"common.event")),g.wc(3),g.Ad(g.ad(15,11,"common.customer")),g.wc(4),g.ed("ngForOf",t.orders))},directives:[r.k,r.l],pipes:[f.c,J.a,O.a,r.b],styles:[".table[_ngcontent-%COMP%]{min-width:980px}"]});var q=function(e,t,n,r){return new(n||(n=Promise))((function(c,i){function o(e){try{d(r.next(e))}catch(t){i(t)}}function a(e){try{d(r.throw(e))}catch(t){i(t)}}function d(e){var t;e.done?c(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,a)}d((r=r.apply(e,t||[])).next())}))};const X=["datepicker"];function ee(e,t){if(1&e){const e=g.Qc();g.Pc(0,"div",10),g.Pc(1,"app-order-condition",11),g.Wc("changeConditions",(function(t){g.rd(e);return g.Yc(2).changeConditions(t)})),g.Zc(2,"translate"),g.Oc(),g.Oc()}if(2&e){const e=g.Yc(2);g.wc(1),g.ed("name",g.ad(2,2,"order.search.search"))("paymentTypes",e.paymentTypes)}}function te(e,t){if(1&e){const e=g.Qc();g.Pc(0,"div"),g.Pc(1,"div",7),g.Pc(2,"button",8),g.Wc("click",(function(){g.rd(e);return g.Yc().changeSearchType("event")})),g.zd(3),g.Zc(4,"translate"),g.Oc(),g.Oc(),g.xd(5,ee,3,4,"div",9),g.Oc()}if(2&e){const e=g.Yc();g.wc(3),g.Bd(" ",g.ad(4,2,"order.search.searchType.event")," "),g.wc(2),g.ed("ngIf",e.paymentTypes.length>0)}}function ne(e,t){1&e&&(g.Kc(0,"p",22),g.Zc(1,"translate")),2&e&&g.ed("innerHTML",g.ad(1,1,"order.search.schedule.notfound"),g.sd)}function re(e,t){if(1&e){const e=g.Qc();g.Pc(0,"app-performances",23),g.Wc("select",(function(t){g.rd(e);return g.Yc(2).selectSchedule(t)})),g.Oc()}if(2&e){const e=t.$implicit,n=g.Yc(2);g.ed("screeningEventsGroup",e)("creativeWork",n.getCreativeWorks(null==e.screeningEvent.workPerformed?null:e.screeningEvent.workPerformed.identifier))("contentRatingTypes",n.contentRatingTypes)}}function ce(e,t){if(1&e&&(g.Pc(0,"div",24),g.Kc(1,"app-item-event",25),g.Oc()),2&e){const e=g.Yc(2);g.wc(1),g.ed("screeningEvent",e.screeningEvent)}}const ie=function(){return{dateInputFormat:"YYYY/MM/DD",adaptivePosition:!0,showWeekNumbers:!1}};function oe(e,t){if(1&e){const e=g.Qc();g.Pc(0,"div"),g.Pc(1,"div",7),g.Pc(2,"button",8),g.Wc("click",(function(){g.rd(e);return g.Yc().changeSearchType("input")})),g.zd(3),g.Zc(4,"translate"),g.Oc(),g.Oc(),g.Pc(5,"div",10),g.Pc(6,"div",12),g.Pc(7,"div",13),g.Pc(8,"input",14,15),g.Wc("ngModelChange",(function(t){g.rd(e);return g.Yc().scheduleDate=t}))("bsValueChange",(function(t){g.rd(e);return g.Yc().selectDate(t)}))("click",(function(){g.rd(e);return g.Yc().setDatePicker()}))("onShown",(function(t){g.rd(e);return g.Yc().onShowPicker(t)})),g.Oc(),g.Pc(10,"div",16),g.Wc("click",(function(){g.rd(e);return g.Yc().toggleDatepicker()})),g.Pc(11,"span",17),g.Kc(12,"i",18),g.Oc(),g.Oc(),g.Oc(),g.Oc(),g.xd(13,ne,2,3,"p",19),g.xd(14,re,1,3,"app-performances",20),g.Oc(),g.xd(15,ce,2,1,"div",21),g.Oc()}if(2&e){const e=g.Yc();g.wc(3),g.Bd(" ",g.ad(4,6,"order.search.searchType.input")," "),g.wc(5),g.ed("ngModel",e.scheduleDate)("bsConfig",g.gd(8,ie)),g.wc(5),g.ed("ngIf",0===e.screeningEventsGroup.length),g.wc(1),g.ed("ngForOf",e.screeningEventsGroup),g.wc(1),g.ed("ngIf",e.screeningEvent)}}function ae(e,t){1&e&&(g.Pc(0,"p",26),g.zd(1),g.Zc(2,"translate"),g.Oc()),2&e&&(g.wc(1),g.Ad(g.ad(2,1,"order.search.order.notfound")))}function de(e,t){if(1&e&&(g.Pc(0,"option",38),g.zd(1),g.Zc(2,"translate"),g.Oc()),2&e){const e=g.Yc(2);g.ed("value",e.OrderActions.Cancel),g.wc(1),g.Ad(g.ad(2,2,"order.search.cancel"))}}function se(e,t){if(1&e&&(g.Pc(0,"option",38),g.zd(1),g.Zc(2,"translate"),g.Oc()),2&e){const e=g.Yc(2);g.ed("value",e.OrderActions.Print),g.wc(1),g.Ad(g.ad(2,2,"order.search.print"))}}function le(e,t){if(1&e){const e=g.Qc();g.Pc(0,"div",26),g.Pc(1,"div",27),g.Pc(2,"div",28),g.Pc(3,"div",29),g.Pc(4,"pagination",30),g.Wc("ngModelChange",(function(t){g.rd(e);return g.Yc().currentPage=t}))("pageChanged",(function(t){g.rd(e);return g.Yc().changePage(t)})),g.Oc(),g.Oc(),g.Oc(),g.Pc(5,"div",31),g.Pc(6,"select",32),g.Wc("ngModelChange",(function(t){g.rd(e);return g.Yc().actionSelect=t})),g.Pc(7,"option",33),g.zd(8),g.Zc(9,"translate"),g.Oc(),g.xd(10,de,3,4,"option",34),g.xd(11,se,3,4,"option",34),g.Oc(),g.Pc(12,"button",35),g.Wc("click",(function(){g.rd(e);return g.Yc().selectedAction()})),g.zd(13),g.Zc(14,"translate"),g.Oc(),g.Oc(),g.Oc(),g.Pc(15,"div",36),g.Pc(16,"app-order-table",37),g.Wc("detail",(function(t){g.rd(e);return g.Yc().openDetail(t)}))("select",(function(t){g.rd(e);return g.Yc().toggleOrder(t)}))("print",(function(t){g.rd(e);return g.Yc().printConfirm(t)}))("receipt",(function(t){g.rd(e);return g.Yc().printReceiptConfirm(t)}))("return",(function(t){g.rd(e);return g.Yc().cancelConfirm(t)})),g.Oc(),g.Oc(),g.Oc()}if(2&e){const e=g.Yc();g.wc(4),g.ed("ngModel",e.currentPage)("totalItems",e.totalCount)("itemsPerPage",e.limit)("maxSize",e.maxSize)("boundaryLinks",!1),g.wc(2),g.ed("ngModel",e.actionSelect),g.wc(2),g.Ad(g.ad(9,12,"order.search.unselected")),g.wc(2),g.ed("ngIf",e.environment.ORDER_CANCEL),g.wc(1),g.ed("ngIf",e.environment.ORDER_PRINT),g.wc(2),g.Ad(g.ad(14,14,"order.search.apply")),g.wc(3),g.ed("orders",e.orders)("selectedOrders",e.selectedOrders)}}class he{constructor(e,t,n,r,c,i,o,a){this.store=e,this.modal=t,this.utilService=n,this.actionService=r,this.masterService=c,this.translate=i,this.localeService=o,this.router=a,this.moment=l,this.orderStatus=d.factory.orderStatus,this.paymentMethodType=d.factory.paymentMethodType,this.OrderActions=h.b.Order.Action.OrderActions,this.environment=Object(u.a)(),this.order2EventOrders=h.a.Purchase.order2EventOrders,this.connectionType=h.b.Util.Printer.ConnectionType}ngOnInit(){return q(this,void 0,void 0,(function*(){this.actionSelect="",this.selectedOrders=[],this.isLoading=this.store.pipe(Object(s.m)(p.c)),this.error=this.store.pipe(Object(s.m)(p.b)),this.user=this.store.pipe(Object(s.m)(p.i)),this.orders=[],this.maxSize=1,this.currentPage=1,this.limit=20,this.totalCount=this.limit,this.screeningEventsGroup=[],this.creativeWorks=[],this.contentRatingTypes=[],this.scheduleDate=l(l().format("YYYYMMDD"),"YYYYMMDD").toDate(),this.searchType="input",this.paymentTypes=[];try{this.contentRatingTypes=yield this.masterService.searchCategoryCode({categorySetIdentifier:d.factory.chevre.categoryCode.CategorySetIdentifier.ContentRatingType}),this.paymentTypes=yield this.masterService.searchCategoryCode({categorySetIdentifier:d.factory.chevre.categoryCode.CategorySetIdentifier.PaymentMethodType})}catch(e){return void this.router.navigate(["/error"])}}))}toggleOrder(e){if(void 0===this.selectedOrders.find(t=>t.orderNumber===e.orderNumber))return void this.selectedOrders.push(e);const t=this.selectedOrders.findIndex(t=>t.orderNumber===e.orderNumber);this.selectedOrders.splice(t,1)}search(){return q(this,void 0,void 0,(function*(){try{this.currentPage=this.conditions.page,this.selectedOrders=[];const e=h.a.Order.input2OrderSearchCondition({input:this.conditions,theater:(yield this.actionService.user.getData()).theater,page:this.currentPage,limit:this.limit});this.orders=(yield this.actionService.order.search(e)).data,this.nextOrders=(yield this.actionService.order.search(Object.assign(Object.assign({},e),{page:this.currentPage+1}))).data;const t=0===this.nextOrders.length?this.currentPage*this.limit:(this.currentPage+1)*this.limit;this.totalCount=this.totalCount<t?t:this.totalCount;const n=this.totalCount/this.limit,r=5;this.maxSize=n>r?r:n}catch(e){console.error(e),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.search.alert.search"),error:"{}"===JSON.stringify(e)?e:JSON.stringify(e)})}}))}changeConditions(e){return q(this,void 0,void 0,(function*(){this.conditions=e,this.totalCount=this.limit,this.maxSize=1,yield this.search()}))}changePage(e){return q(this,void 0,void 0,(function*(){this.conditions.page=e.page,yield this.search()}))}printConfirm(e){this.utilService.openConfirm({title:this.translate.instant("common.confirm"),body:this.translate.instant("order.search.confirm.print"),cb:()=>q(this,void 0,void 0,(function*(){try{const t=yield this.actionService.user.getData();if(void 0===t.printer)throw new Error("printer undefined");const n=t.pos,r=t.printer;yield this.actionService.order.print({orders:e,pos:n,printer:r})}catch(t){console.error(t),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.search.alert.print"),error:"{}"===JSON.stringify(t)?t:JSON.stringify(t)})}}))})}printReceiptConfirm(e){this.utilService.openConfirm({title:this.translate.instant("common.confirm"),body:this.translate.instant("order.search.confirm.print"),cb:()=>q(this,void 0,void 0,(function*(){try{const t=yield this.actionService.user.getData();if(void 0===t.printer)throw new Error("printer undefined");const n=t.pos,r=t.printer;yield this.actionService.order.printReceipt({orders:e,pos:n,printer:r})}catch(t){console.error(t),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.search.alert.print"),error:"{}"===JSON.stringify(t)?t:JSON.stringify(t)})}}))})}cancelConfirm(e){const t=h.a.Util.createRandomString(6,/[^0-9]/g);this.utilService.openConfirm({title:this.translate.instant("common.confirm"),body:this.translate.instant("order.search.confirm.cancel",{value:t}),code:t,cb:()=>q(this,void 0,void 0,(function*(){try{const t=yield this.actionService.user.getData();yield this.actionService.order.cancel({orders:e,language:t.language}),this.changePage({page:this.conditions.page})}catch(t){console.error(t),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.search.alert.cancel"),error:"{}"===JSON.stringify(t)?t:JSON.stringify(t)})}}))})}openDetail(e){this.modal.show(Z.a,{class:"modal-dialog-centered modal-lg",initialState:{order:e,paymentTypes:this.paymentTypes}})}selectedAction(){if(0!==this.selectedOrders.length)if(this.actionSelect===h.b.Order.Action.OrderActions.Cancel){const e=h.a.Util.createRandomString(6,/[^0-9]/g);this.utilService.openConfirm({title:this.translate.instant("common.confirm"),body:this.translate.instant("order.search.confirm.cancel",{value:e}),code:e,cb:()=>q(this,void 0,void 0,(function*(){try{const e=yield this.actionService.user.getData();yield this.actionService.order.cancel({orders:this.selectedOrders,language:e.language}),this.changePage({page:this.conditions.page})}catch(e){console.error(e),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.search.alert.cancel"),error:"{}"===JSON.stringify(e)?e:JSON.stringify(e)})}}))})}else this.actionSelect===h.b.Order.Action.OrderActions.Print&&this.utilService.openConfirm({title:this.translate.instant("common.confirm"),body:this.translate.instant("order.search.confirm.print"),cb:()=>q(this,void 0,void 0,(function*(){try{const e=yield this.actionService.user.getData();if(void 0===e.printer)throw new Error("printer undefined");const t=e.pos,n=e.printer,r=this.selectedOrders;yield this.actionService.order.print({orders:r,pos:t,printer:n})}catch(e){console.error(e),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.search.alert.print"),error:"{}"===JSON.stringify(e)?e:JSON.stringify(e)})}}))});else this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.search.alert.unselected")})}selectDate(e){return q(this,void 0,void 0,(function*(){if(null==e)return;this.scheduleDate=e;const t=(yield this.actionService.user.getData()).theater;void 0===this.scheduleDate&&(this.scheduleDate=l().add(this.environment.PURCHASE_SCHEDULE_DEFAULT_SELECTED_DATE,"day").toDate());const n=l(this.scheduleDate).format("YYYY-MM-DD");if(void 0!==t)try{this.creativeWorks=yield this.masterService.searchMovies({offers:{availableFrom:l(n).toDate()}});let e=this.creativeWorks.map(e=>e.identifier);0===this.creativeWorks.length&&(e=(yield this.masterService.searchScreeningEvent({superEvent:{locationBranchCodes:[t.branchCode]},startFrom:l(n).toDate(),startThrough:l(n).add(1,"day").add(-1,"millisecond").toDate()})).filter(e=>void 0!==e.workPerformed).map(e=>{var t;return(null===(t=e.workPerformed)||void 0===t?void 0:t.identifier)||""}));const r="screeningEventSeries"===this.environment.PURCHASE_SCHEDULE_SORT?yield this.masterService.searchScreeningEventSeries({location:{branchCode:{$eq:t.branchCode}},workPerformed:{identifiers:Array.from(new Set(e))}}):[],c="screen"===this.environment.PURCHASE_SCHEDULE_SORT?yield this.masterService.searchScreeningRooms({branchCode:{$eq:t.branchCode}}):[],i=yield this.masterService.searchScreeningEvent({superEvent:{locationBranchCodes:[t.branchCode]},startFrom:l(n).toDate(),startThrough:l(n).add(1,"day").add(-1,"millisecond").toDate(),screeningEventSeries:r,screeningRooms:c}),o=l((yield this.utilService.getServerTime()).date).toDate();this.screeningEventsGroup=h.a.Purchase.screeningEvents2ScreeningEventSeries({screeningEvents:i,now:o})}catch(r){console.error(r),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("order.searchEvent.alert.schedule"),error:"{}"===JSON.stringify(r)?r:JSON.stringify(r)})}}))}selectSchedule(e){return q(this,void 0,void 0,(function*(){this.screeningEvent=e,yield this.changeConditions({confirmationNumber:"",orderNumber:"",customer:{id:"",familyName:"",givenName:"",email:"",telephone:""},orderStatus:"",paymentMethodType:"",eventIds:[e.id],posId:"",page:1});const t=document.querySelector("#screeningEvent");null!==t&&t.scrollIntoView({behavior:"smooth",block:"start"})}))}setDatePicker(){this.user.subscribe(e=>{this.localeService.use(e.language)}).unsubscribe()}toggleDatepicker(){this.setDatePicker(),this.datepicker.toggle()}onShowPicker(e){h.a.Util.iOSDatepickerTapBugFix(e,[this.datepicker])}changeSearchType(e){this.searchType=e}getCreativeWorks(e){return this.creativeWorks.find(t=>t.identifier===e)}}he.\u0275fac=function(e){return new(e||he)(g.Jc(s.b),g.Jc(I.b),g.Jc(m.f),g.Jc(m.a),g.Jc(m.d),g.Jc(f.d),g.Jc(v.d),g.Jc(i.b))},he.\u0275cmp=g.Dc({type:he,selectors:[["app-order-search"]],viewQuery:function(e,t){var n;(1&e&&g.Fd(X,!0),2&e)&&(g.nd(n=g.Xc())&&(t.datepicker=n.first))},decls:14,vars:13,consts:[[1,"contents-width","mx-auto","px-3","py-5"],[1,"text-large","mb-4","text-center","font-weight-bold"],[1,"mb-4","text-md-center",3,"innerHTML"],[4,"ngIf"],["class","mb-4",4,"ngIf"],[1,"buttons","mx-auto","text-center"],["type","button","routerLink","/order",1,"btn","btn-outline-primary","btn-block","py-3"],[1,"mb-2","text-right"],["type","button",1,"btn","btn-primary","text-small",3,"click"],["class","p-3 bg-white mb-4",4,"ngIf"],[1,"p-3","bg-white","mb-4"],[3,"name","paymentTypes","changeConditions"],[1,"mb-3"],[1,"input-group"],["type","text","placeholder","Datepicker","bsDatepicker","","readonly","",1,"form-control",3,"ngModel","bsConfig","ngModelChange","bsValueChange","click","onShown"],["datepicker","bsDatepicker"],[1,"input-group-append","pointer",3,"click"],[1,"input-group-text"],[1,"bi","bi-calendar"],[3,"innerHTML",4,"ngIf"],[3,"screeningEventsGroup","creativeWork","contentRatingTypes","select",4,"ngFor","ngForOf"],["id","screeningEvent","class","mb-3",4,"ngIf"],[3,"innerHTML"],[3,"screeningEventsGroup","creativeWork","contentRatingTypes","select"],["id","screeningEvent",1,"mb-3"],[3,"screeningEvent"],[1,"mb-4"],[1,"d-md-flex","align-items-center","justify-content-between","mb-4"],[1,"text-md-right","text-center","mb-3","mb-md-0","order-2"],[1,"d-inline-block"],["previousText","\u2039","nextText","\u203a","firstText","\xab","lastText","\xbb",3,"ngModel","totalItems","itemsPerPage","maxSize","boundaryLinks","ngModelChange","pageChanged"],[1,"form-group","text-center","text-md-left","mb-3","mb-md-0","order-1"],["name","actionSelect","id","actionSelect",1,"form-control","d-inline-block","w-auto","mr-2",3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngIf"],["id","selectedActionButton","type","button",1,"btn","btn-primary","py-2","px-4",3,"click"],[1,"scroll-horizontal"],[3,"orders","selectedOrders","detail","select","print","receipt","return"],[3,"value"]],template:function(e,t){1&e&&(g.Pc(0,"div",0),g.Pc(1,"h2",1),g.zd(2),g.Zc(3,"translate"),g.Oc(),g.Kc(4,"p",2),g.Zc(5,"translate"),g.xd(6,te,6,4,"div",3),g.xd(7,oe,16,9,"div",3),g.xd(8,ae,3,3,"p",4),g.xd(9,le,17,16,"div",4),g.Pc(10,"div",5),g.Pc(11,"button",6),g.zd(12),g.Zc(13,"translate"),g.Oc(),g.Oc(),g.Oc()),2&e&&(g.wc(2),g.Ad(g.ad(3,7,"order.search.title")),g.wc(2),g.ed("innerHTML",g.ad(5,9,"order.search.read"),g.sd),g.wc(2),g.ed("ngIf","input"===t.searchType),g.wc(1),g.ed("ngIf","event"===t.searchType),g.wc(1),g.ed("ngIf",0===t.orders.length),g.wc(1),g.ed("ngIf",t.orders.length>0),g.wc(3),g.Ad(g.ad(13,11,"order.search.prev")))},directives:[r.l,i.c,T,v.b,b.a,v.a,b.k,b.n,y.b,r.k,z.a,W.a,F.a,b.r,b.o,b.t,V],pipes:[f.c],styles:[".scroll-horizontal[_ngcontent-%COMP%]   .table[_ngcontent-%COMP%]{min-width:980px}"]});const ue=[{path:"",component:a.a,canActivate:[o.a,o.c],children:[{path:"",component:E},{path:"search",component:he},{path:"download",component:A}]}];class me{}me.\u0275mod=g.Hc({type:me}),me.\u0275inj=g.Gc({factory:function(e){return new(e||me)},imports:[[i.d.forChild(ue)],i.d]});class pe{}pe.\u0275mod=g.Hc({type:pe}),pe.\u0275inj=g.Gc({factory:function(e){return new(e||pe)},imports:[[r.c,me,c.a]]})}}]);