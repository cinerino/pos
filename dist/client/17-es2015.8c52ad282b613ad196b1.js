(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{AL2A:function(t,e,r){"use strict";r.r(e),r.d(e,"SettingModule",(function(){return S}));var i=r("2kYt"),n=r("DSWM"),o=r("sEIs"),a=r("RRjC"),s=r("sN6X"),c=r("x8Mb"),l=r("PIN6"),d=r("cHUu"),p=r("mOXJ"),u=r("EM62"),h=r("s2Ay"),v=r("+Lug"),m=r("uWtv"),f=r("6WEN"),g=function(t,e,r,i){return new(r||(r=Promise))((function(n,o){function a(t){try{c(i.next(t))}catch(e){o(e)}}function s(t){try{c(i.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?n(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))};function y(t,e){if(1&t){const t=u.Qc();u.Pc(0,"app-input-app",12),u.Wc("valueChanges",(function(e){u.rd(t);return u.Yc().appForm=e})),u.Oc()}if(2&t){const t=u.Yc();u.ed("theaters",t.theaters)("data",null==t.inputData?null:t.inputData.app)}}function b(t,e){if(1&t){const t=u.Qc();u.Pc(0,"app-input-device",13),u.Wc("valueChanges",(function(e){u.rd(t);return u.Yc().deviceForm=e}))("print",(function(){u.rd(t);return u.Yc().print()}))("drawer",(function(){u.rd(t);return u.Yc().openDrawer()})),u.Oc()}if(2&t){const t=u.Yc();u.ed("data",null==t.inputData?null:t.inputData.device)}}function w(t,e){if(1&t){const t=u.Qc();u.Pc(0,"app-input-customer",14),u.Wc("valueChanges",(function(e){u.rd(t);return u.Yc().profileForm=e})),u.Zc(1,"async"),u.Oc()}if(2&t){const t=u.Yc();var r;const e=null==(r=u.ad(1,2,t.user))?null:r.language;u.ed("profile",t.inputData.profile)("language",e)}}class F{constructor(t,e,r,i,n,o){this.store=t,this.utilService=e,this.actionService=r,this.masterService=i,this.translate=n,this.router=o,this.viewType=c.b.Util.ViewType,this.environment=Object(l.a)()}ngOnInit(){return g(this,void 0,void 0,(function*(){this.user=this.store.pipe(Object(s.m)(p.i)),this.error=this.store.pipe(Object(s.m)(p.b)),this.isLoading=this.store.pipe(Object(s.m)(p.c)),this.theaters=[];try{this.theaters=yield this.masterService.searchMovieTheaters();const{theater:t,entranceGate:e,pos:r,printer:i,drawer:n,customerContact:o}=yield this.actionService.user.getData();this.inputData={app:{theater:t,entranceGate:e,pos:r},device:{printerType:null==i?void 0:i.connectionType,printerIpAddress:null==i?void 0:i.ipAddress,drawer:void 0!==n&&n?"1":"0"},profile:o}}catch(t){console.error(t),this.router.navigate(["/error"])}}))}onSubmit(){return g(this,void 0,void 0,(function*(){if(Object.keys(this.appForm.controls).forEach(t=>{this.appForm.controls[t].markAsTouched()}),Object.keys(this.deviceForm.controls).forEach(t=>{this.deviceForm.controls[t].markAsTouched()}),Object.keys(this.profileForm.controls).forEach(t=>{this.profileForm.controls[t].markAsTouched()}),this.appForm.invalid||this.deviceForm.invalid||this.profileForm.invalid)this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("setting.alert.validation")});else try{const t=this.appForm.controls.theaterId.value,e=this.appForm.controls.posId.value,r=this.appForm.controls.entranceGateId.value,i=this.theaters.find(e=>e.id===t);if(void 0===i)throw new Error("theater not found");const n=void 0===i.hasPOS?void 0:i.hasPOS.find(t=>t.id===e),o=void 0===i.hasEntranceGate?void 0:i.hasEntranceGate.find(t=>t.identifier===r),a=[];Object.keys(this.profileForm.controls).forEach(t=>{/additionalProperty/.test(t)&&a.push({name:t.replace("additionalProperty.",""),value:this.profileForm.controls[t].value})}),this.actionService.user.updateAll({theater:i,pos:n,entranceGate:o,customerContact:{familyName:void 0===this.profileForm.controls.familyName?void 0:this.profileForm.controls.familyName.value,givenName:void 0===this.profileForm.controls.givenName?void 0:this.profileForm.controls.givenName.value,email:void 0===this.profileForm.controls.email?void 0:this.profileForm.controls.email.value,telephone:void 0===this.profileForm.controls.telephone?void 0:this.profileForm.controls.telephone.value.e164Number,age:void 0===this.profileForm.controls.age?void 0:this.profileForm.controls.age.value,address:void 0===this.profileForm.controls.address?void 0:this.profileForm.controls.address.value,gender:void 0===this.profileForm.controls.gender?void 0:this.profileForm.controls.gender.value,additionalProperty:a},printer:{ipAddress:this.deviceForm.controls.printerIpAddress.value,connectionType:this.deviceForm.controls.printerType.value},drawer:"0"!==this.deviceForm.controls.drawer.value}),this.utilService.openAlert({title:this.translate.instant("common.complete"),body:this.translate.instant("setting.alert.success")})}catch(t){console.error(t),this.utilService.openAlert({title:this.translate.instant("common.error"),body:"",error:"{}"===JSON.stringify(t)?t:JSON.stringify(t)})}}))}print(){return g(this,void 0,void 0,(function*(){const t={connectionType:this.deviceForm.controls.printerType.value,ipAddress:this.deviceForm.controls.printerIpAddress.value};try{yield this.actionService.order.print({orders:[],printer:t})}catch(e){console.error(e),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("setting.alert.print"),error:"{}"===JSON.stringify(e)?e:JSON.stringify(e)})}}))}openDrawer(){return g(this,void 0,void 0,(function*(){const t={connectionType:this.deviceForm.controls.printerType.value,ipAddress:this.deviceForm.controls.printerIpAddress.value};try{yield this.actionService.order.openDrawer({printer:t})}catch(e){this.utilService.loadEnd(),console.error(e),this.utilService.openAlert({title:this.translate.instant("common.error"),body:this.translate.instant("setting.alert.drawer"),error:"{}"===JSON.stringify(e)?e:JSON.stringify(e)})}}))}}F.\u0275fac=function(t){return new(t||F)(u.Jc(s.b),u.Jc(d.f),u.Jc(d.a),u.Jc(d.d),u.Jc(h.d),u.Jc(o.b))},F.\u0275cmp=u.Dc({type:F,selectors:[["app-setting"]],decls:30,vars:28,consts:[[1,"contents-width","mx-auto","px-3","py-5"],[1,"mb-4"],[1,"text-large","mb-4","text-center","font-weight-bold"],[1,"mb-4","text-md-center",3,"innerHTML"],[1,"p-3","bg-white","mb-4"],[1,"font-weight-bold","mb-3"],[3,"theaters","data","valueChanges",4,"ngIf"],[3,"data","valueChanges","print","drawer",4,"ngIf"],[3,"profile","language","valueChanges",4,"ngIf"],[1,"buttons","mx-auto","text-center"],["type","submit",1,"btn","btn-primary","btn-block","py-3","mb-3",3,"disabled","click"],["type","button",1,"btn","btn-outline-primary","btn-block","py-3",3,"routerLink"],[3,"theaters","data","valueChanges"],[3,"data","valueChanges","print","drawer"],[3,"profile","language","valueChanges"]],template:function(t,e){1&t&&(u.Pc(0,"div",0),u.Pc(1,"div",1),u.Pc(2,"h2",2),u.zd(3),u.Zc(4,"translate"),u.Oc(),u.Kc(5,"p",3),u.Zc(6,"translate"),u.Pc(7,"div",4),u.Pc(8,"p",5),u.zd(9),u.Zc(10,"translate"),u.Oc(),u.xd(11,y,1,2,"app-input-app",6),u.Oc(),u.Pc(12,"div",4),u.Pc(13,"p",5),u.zd(14),u.Zc(15,"translate"),u.Oc(),u.xd(16,b,1,1,"app-input-device",7),u.Oc(),u.Pc(17,"div",4),u.Pc(18,"p",5),u.zd(19),u.Zc(20,"translate"),u.Oc(),u.xd(21,w,2,4,"app-input-customer",8),u.Oc(),u.Oc(),u.Pc(22,"div",9),u.Pc(23,"button",10),u.Wc("click",(function(){return e.onSubmit()})),u.Zc(24,"async"),u.zd(25),u.Zc(26,"translate"),u.Oc(),u.Pc(27,"button",11),u.zd(28),u.Zc(29,"translate"),u.Oc(),u.Oc(),u.Oc()),2&t&&(u.wc(3),u.Ad(u.ad(4,12,"setting.title")),u.wc(2),u.ed("innerHTML",u.ad(6,14,"setting.read"),u.sd),u.wc(4),u.Ad(u.ad(10,16,"setting.app.title")),u.wc(2),u.ed("ngIf",null==e.inputData?null:e.inputData.app),u.wc(3),u.Ad(u.ad(15,18,"setting.device.title")),u.wc(2),u.ed("ngIf",null==e.inputData?null:e.inputData.device),u.wc(3),u.Ad(u.ad(20,20,"setting.customer.title")),u.wc(2),u.ed("ngIf",e.inputData),u.wc(2),u.ed("disabled",u.ad(24,22,e.isLoading)),u.wc(2),u.Ad(u.ad(26,24,"setting.next")),u.wc(2),u.ed("routerLink",e.environment.BASE_URL),u.wc(1),u.Ad(u.ad(29,26,"setting.prev")))},directives:[i.l,o.c,v.a,m.a,f.a],pipes:[h.c,i.b],styles:[""]});const O=[{path:"",component:a.a,children:[{path:"",component:F}]}];class A{}A.\u0275mod=u.Hc({type:A}),A.\u0275inj=u.Gc({factory:function(t){return new(t||A)},imports:[[o.d.forChild(O)],o.d]});class S{}S.\u0275mod=u.Hc({type:S}),S.\u0275inj=u.Gc({factory:function(t){return new(t||S)},imports:[[i.c,A,n.a]]})}}]);